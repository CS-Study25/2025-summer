# TCP/IP의 4계층 구조
    1. 애플리케이션 계층
    2. 전송 계층
    3. 인터넷 계층
    4. 링크 계층

## 1. 애플리케이션 계층
    웹 서비스, 이메일, 파일 전송 등 서비스를 실질적으로 사람들에게 제공하는 계층
- 프로토콜 종류
    - HTTP
    - HTTPS
    - FTP
    - DNS
    - SMTP
    - POP3
    - IMAP

| 프로토콜 | 설명   |
|-------|-------|
| HTTP / HTTPS   | 웹사이트 접속할 때 사용하는 프로토콜   |
| FTP   | 파일을 주고받을 때 사용  |
| DNS  | 도메인 이름 -> IP 주소로 바꿔주는 시스템  |
| SMTP / POP3/ IMAP   | 이메일 보낼 때 사용하는 프로토콜  |
| SSH   | 보안되지 않은 네트워크에서 네트워크 서비스를 안전하게 운영하기 위한 암호화 네트워크 프로토콜|  

## 2. 전송 계층
    데이터를 정확하게, 빠르게 전송하는 계층 
### 전송 계층의 주요 역할 
1. 연결 지향 데이터 스트림 지원 
	- 데이터를 보내기 전에 상대방과 연결부터 맺고, 데이터를 연속적인 흐름(stream) 으로 전송하는 방식
        - 데이터를 보내기 전 3-way handshake로 연결
        - 데이터를 스트림 형태로 주고받음 
        - 통신 끝나면 연결 종료

2. 신뢰성
    - 데이터를 보냈을 때, 정확히 도착했는지 확인하고, 안 왔다면 다시 보내는 기능
    - TCP만 제공한다. 
        - 순서 번호: 데이터 조각들에 번호 붙여서 순서 맞춤
	    - ACK (확인 응답): “잘 받았어!” 라는 응답 패킷 받음
	    - 재전송(Retransmission): 응답 없으면 다시 전송
	    - 오류 검사(Checksum): 데이터가 중간에 깨졌는지 확인

3. 흐름 제어
    - 데이터를 너무 빨리 보내서 상대방이 못 받을 경우를 방지하는 기능
    - 보내는 쪽이 너무 빠르지 않도록 속도 조절
        - 네트워크 병목이나 버퍼 오버플로우 방지에 효과적이다. 

| 프로토콜 | 설명   |패킷 교환 방식
|-------|-------|-------|
| TCP   | 데이터를 정확하게, 순서대로, 확인하며 전송함  | 가상회선 방식
| UDP   | 데이터를 빠르게 보내되, 확인 안함 | 데이터그램 방식

#### 2.1. TCP의 가상회선 패킷 교환 방식
    데이터를 보내기 전에 가상의 통신 경로를 먼저 설정하고,그 경로를 따라 순서대로 데이터가 이동하는 방식

- 모든 패킷들이 같은 경로로 아동하기 때문에 순차적인 이동이 가능함.
    - 각 패킷에 가상회선 식별자가 포함된다. 
- 모든 패킷을 전송하면, 가상회선이 해지된다. 패킷들은 전송된 순서대로 도착한다. 

#### 2.2. UDP의 데이터그램 패킷 교환 방식
    연결 없이 데이터를 하나하나 독립적인 패킷으로 보내는 방식 
    즉, 패킷마다 목적지만 알면 따로따로 보내는 구조
- 각 패킷이 독립적으로 이동하면서 최적의 경로를 선택해서 전송된다. 
- 따라서 각 패킷은 서로 다른 경로로 전송될 수 있으며 도착한 순서가 다를 수 있다. 

#### 2.3. TCP 연결 성립 과정
    TCP는 신뢰성 확보를 위한 3-way handshake 작업을 진행한다. 


- 클라이언트 - 서버의 통신 단계 3가지
#### SYN
    연결 요청 플래그
#### ACK
    응답 플래그

1. SYN 단계 (서버야 받아라)
    - 클라이언트가 서버에게 연결 요청(SYN) 메시지를 보낸다 
        - 이때 ISN(첫 번째 패킷에 할당된 임의의 시퀀스 번호)을 클라이언트에 담아서, 서버에 SYN을 보낸다. 
2. SYN + ACK 단계 (클라이언트야, 잘 받았다. 이제 내 응답 받아라)
    - 서버는 클라이언트의 SYN을 수신하고, 서버의 ISN을 보내며, 승인 번호로 클라이언트의 ISN+1을 보낸다. 

3. ACK 단계 (서버야 너 응답 받았다. 이제 완전 확실히 우리 연결이 됐구나)
    - 클라이언트는 서버의 ISN+1한 값 승인번호를 담아 ACK 서버에 보낸다.

#### 2.4. TCP 연결 해제 과정
    TCP가 연결을 해제할 때는 4-way handshake 과정이 발생한다. 
1. 클라이언트의 연결 종료 요청 (서버야 더 이상 보낼 정보가 없으니 연결을 끊을게)
    - FIN →  
2.   서버의 종료 요청 승인 (클라이언트야 알았어, 너 끊는 거 확인했어)
        -  A는 더이상 데이터를 못 보내고, B만 보낼 수 있음
        - ← ACK   
3.   서버의 종료 요청 (클라이언트야 나도 보낼거 다 보냈어 종료할게)
        - ← FIN 
4.  클라이언트의 종료 승인 (서버야 알았어 안녕)
    - ACK →    

- 지연 패킷이 발생할 경우를 대비하기 위해, TIME_WAIT으로 연결을 일정 시간 뒤에 닫는다. 
- 확실히 닫게 하기 위해 TIME_WAIT으로 기다린다.

## 3. 인터넷 계층 
     장치로부터 받은 네트워크 패킷을 IP 주소로 지정된 목적지로 전송하기 위해 사용되는 계층이다. 
| 프로토콜 | 설명  
|-------|-------
| IP   | 데이터를 전 세계 어디로 보낼지 결정해주는 주소 지정 프로토콜  
| ARP   | IP 주소 → MAC 주소로 바꿔주는 프로토콜 
| ICMP  | 네트워크 상태를 진단하고, 오류를 알리는 프로토콜

## 4. 링크 계층
    실제 데이터를 물리적인 장치를 통해 전송하는 역할 

### 4.1.  유선 LAN
    유선 LAN을 이루는 이더넷은 전이중화 통신을 사용한다. 
#### 전이중화(full duplex) 통신
    양쪽이 동시에 데이터를 주고받는 통신 방식 
- 충돌 가능성이 없다. 양방향으로 통신이 가능하기 때문
- 반댓말이 반이중화 통신, 한 쪽만 말하면 다른 한쪽은 기다려야 함



#### 유선 LAN을 이루는 케이블
- TP 케이블 (트위스트 페어 케이블)
    - UTP 케이블 (LAN 케이블)
    - STP
- 광섬유 케이블 
    - 장거리 및 고속 통신 가능 

### 4.2.  무선 LAN
    송신과 수신에 같은 채널을 사용하기 때문에 반이중화 통신을 사용한다. 
    무선 신호 전달 방식으로 두 대 이상의 장치를 연결하는 기술 

#### CSMA/CD
    반이중화 통신 방식이다. 
    데이터를 보낸 이후 충돌이 발생한다면 일정 시간 이후 재전송하는 방식이다. 
- 사전에 충돌을 방지할 수 있다. 

#### 무선 LAN을 이루는 주파수
    보통 5GHz 대역 사용 
1. 와이파이
    - 무선 접속 장치 (공유기)을 통해 유선 LAN에 흐르는 신호를 무선 LAN으로 바꿔준다. 
2. BSS
    - 집에서 공유기 한 개로 스마트폰, 노트북 등에 연결한 Wifi = 하나의 BSS이다. 
    - AP(공유기)간 이동시 연결이 끊긴다. 
    - 같은 BSS안의 장치끼리만 통신 가능하다. 
3. ESS
    - 여러 개의 BSS가 하나의 네트워크처럼 연결된 구조이다. 
    - 여러 AP들이 연결되어 하나의 커다란 무선 네트워크를 구성한다. 
    - 	대학교 캠퍼스에 여러 건물마다 공유기(AP)가 있어도 학생은 건물 사이를 이동하면서 계속 같은 Wi-Fi에 연결되어 있다. 

#### 이더넷 프레임 
    이더넷 환경 (LAN)에서 데이터를 전송할 때, MAC 주소·데이터·오류 검사 정보 등을 포함한 전송 단위이다. 
- 전송하려는 데이터를 정해진 틀(frame)에 맞게 담아서 전송한다. 
- 구성
    - Preamble
        - 이더넷 프레임이 시작임을 알린다. 
    - SFD
        - 다음 바이트부터 MAC 주소 필드가 시작됨을 알린다. 
    - DMAC
        - 누구에게 보낼지, 받는 쪽의 MAC 주소를 담는다. 
    - SMAC
        - 누가 보냈는지, 보낸 쪽의 MAC 주소를 담는다. 

    - EtherType
        - 어떤 상위 프로토콜인지 담는다. 
    - Playload
        - 전달하고자 하는 데이터를 담는다. 
    - CRC
        - 에러 확인 비트를 담는다. 



## 5. 계층 간 데이터 송수신 과정
### 5.1 데이터의 캡슐화 과정
     헤더를 덧붙여가며, 캡슐화를 한다. 

| 계층 | 설명   |
|-------|-------|
| 애플리케이션   | 데이터   |
| 전송   | TCP헤더 + 데이터  |
| 인터넷  | IP헤더 + TCP헤더 + 데이터  |
| 링크   | 프레임 헤더 + IP헤더 + TCP헤더+ 데이터 + 프레임 트레일러   |

### 5.2. 데이터의 비캡슐화 과정
    하위 계층에서 상위 계층으로 가며, 헤더를 제거해가며 비캡슐화 한다. 
- 최종적으로 사용자에게 애플리케이션의 PDU (메시지)로 전달된다. 

## 6. PDU
     네트워크 계층마다 데이터의 이름이 달라지는 개념

| OSI 계층 | TCP/IP 계층  |설명   |
|-------|-------|-------|
| 7~5 계층   | 애플리케이션 계층  | 메시지 |
| 4 계층  | 전송 계층  | 세그먼트(TCP), 데이터그램(UDP)  |
| 3 계층   | 인터넷 계층  | 패킷   |
| 1 + 2계층 (물리+링크)   | 링크 계층  | 프레임(데이터 링크 계층), 비트(물리 계층) |